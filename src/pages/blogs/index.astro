---
import Layout from '../../layouts/Layout.astro'
import HeroBlogs from '../../components/sections/HeroBlogs.astro'
import Container from '../../components/shared/Container.astro'
import Button from '../../components/shared/Button.astro'
import BlogItem from '../../components/elements/BlogItem.astro'
import { GetBlog } from '../../api'
import { filterBlogs } from '../../utils/helper'

const { Blogs, Users, Categories, Tags } = await GetBlog()
const FilteredBlogs = filterBlogs(Blogs, {
  filterByCategory: Astro.url.searchParams.get('category'),
  filterByTags: Astro.url.searchParams.get('tag')
})
---

<Layout
  title='Blogs | Bitwit Techno'
  description='Dive into a rich tapestry of insights, ideas, and inspiration with our diverse blog collection. Explore thought-provoking content and perspectives!'
  image='/images/blogs.webp'
>
  <main class='flex flex-col gap-y-20 md:gap-y-32 overflow-hidden'>
    <HeroBlogs />
    <Container>
      <div class='grid grid-cols-12 gap-[30px]'>
        <div class='lg:col-span-8 col-span-12 pb-10'>
          <div class='grid md:grid-cols-2 grid-cols-1 gap-[30px]'>
            {
              FilteredBlogs?.map((blogItem: any) => {
                const user = Users?.filter(
                  (item: any) => blogItem.user === item.id
                )
                const category = Categories?.filter(
                  (item: any) => blogItem.category === item.id
                )
                return (
                  <BlogItem
                    data={blogItem}
                    user={user[0]}
                    category={category[0]}
                  />
                )
              })
            }
          </div>
        </div>
        <div class='lg:col-span-4 col-span-12'>
          <div class='space-y-[30px]'>
            <form
              action='#'
              class='py-1 pl-6 w-full pr-1 flex gap-3 items-center text-heading-3 shadow-lg shadow-box-shadow
                    border border-box-border bg-box-bg rounded-full ease-linear focus-within:bg-body focus-within:border-primary'
            >
              <input
                type='text'
                name='search'
                id='search'
                placeholder='Search Blog'
                class='w-full py-3 outline-none bg-transparent'
              />
              <Button
                variant={'primary'}
                className={'min-w-max text-white'}
                type='button'
                title='get-started'
              >
                <span class='hidden sm:flex relative z-[5]'>Search</span>
                <span class='flex sm:hidden relative z-[5]'>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    fill='none'
                    viewBox='0 0 24 24'
                    stroke-width='1.5'
                    stroke='currentColor'
                    class='w-5 h-5'
                  >
                    <path
                      stroke-linecap='round'
                      stroke-linejoin='round'
                      d='M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5'
                    ></path>
                  </svg>
                </span>
              </Button>
            </form>
            <div
              class='bg-white dark:bg-box-bg p-5 rounded-lg shadow-lg shadow-box-shadow'
            >
              <h4 class='font-bold text-xl text-blue-950 dark:text-gray-400'>
                Categories
              </h4>

              <div class='mt-4 space-y-4'>
                {
                  Categories?.map((item: any) => (
                    <a
                      href={`/blogs?category=${item.id}`}
                      class='flex justify-between bg-gray-50 dark:bg-blue-500 dark:bg-opacity-10 py-4 px-5 rounded-md hover:dark:bg-blue-500 hover:bg-blue-500 hover:text-white dark:text-gray-500 hover:dark:text-white transition-all
                            duration-150'
                    >
                      <span>
                        {item.name} ({item.count})
                      </span>
                      <span class='text-2xl'>
                        <svg
                          xmlns='http://www.w3.org/2000/svg'
                          width='1em'
                          height='1em'
                          viewBox='0 0 20 20'
                        >
                          <path
                            fill='currentColor'
                            fill-rule='evenodd'
                            d='M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10L8.22 6.28a.75.75 0 0 1 0-1.06'
                            clip-rule='evenodd'
                          />
                        </svg>
                      </span>
                    </a>
                  ))
                }
              </div>
            </div>

            <div
              class='bg-white dark:bg-box-bg p-5 rounded-lg shadow-lg shadow-box-shadow'
            >
              <h4 class='font-bold text-xl text-blue-950 dark:text-gray-400'>
                Popular Tags
              </h4>
              <div class='mt-4 flex gap-3 flex-wrap'>
                {
                  Tags?.map((item: any) => (
                    <a
                      href={`/blogs?tag=${item.id}`}
                      class='px-3 py-1 rounded text-base transition-all duration-150 bg-gray-50 dark:bg-blue-500 dark:bg-opacity-10 hover:dark:bg-blue-500 hover:bg-blue-500 hover:text-white dark:text-gray-500 hover:dark:text-white'
                    >
                      {item.name}
                    </a>
                  ))
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </main>
</Layout>
